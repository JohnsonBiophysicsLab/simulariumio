#!/usr/bin/env python
# -*- coding: utf-8 -*-

import pytest
import numpy as np

from simulariumio import Converter


@pytest.mark.parametrize(
    "trajectory, expected_data",
    [
        # 3 fiber agents
        (
            {
                "box_size": np.array([0.5, 0.5, 0.5]),
                "data": {
                    "fibers": {
                        "filepath": "simulariumio/tests/data/cytosim"
                        "/3_fibers/fiber_points.txt",
                        "types": {"0": "actin"},
                    }
                },
                "scale_factor": 1e3,
            },
            {
                "trajectoryInfo": {
                    "version": 1,
                    "timeStepSize": 0.1,
                    "totalSteps": 3,
                    "size": {"x": 500.0, "y": 500.0, "z": 500.0},
                    "nAgentTypes": 1,
                    "0": {"name": "actin"},
                },
                "spatialData": {
                    "version": 1,
                    "msgType": 1,
                    "bundleStart": 0,
                    "bundleSize": 3,
                    "bundleData": [
                        {
                            "frameNumber": 0,
                            "time": 0.1,
                            "data": [
                                1001.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                9.0,
                                -3.70929,
                                110.164,
                                -400.052,
                                -009.70537,
                                110.184,
                                -391.947,
                                -15.7378,
                                110.304,
                                -383.87,
                                1001.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                18.0,
                                39.440000000000005,
                                -60.4351,
                                -344.994,
                                37.8824,
                                -50.56,
                                -347.361,
                                36.3195,
                                -40.6802,
                                -349.704,
                                34.7773,
                                -30.804000000000002,
                                -352.077,
                                33.265,
                                -20.9349,
                                -354.497,
                                31.8441,
                                -11.0556,
                                -356.932,
                                1001.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                12.0,
                                42.215700000000005,
                                -93.7993,
                                -349.962,
                                40.2307,
                                -101.867,
                                -346.47499999999997,
                                38.2648,
                                -109.90700000000001,
                                -342.916,
                                36.3465,
                                -117.922,
                                -339.274,
                            ],
                        },
                        {
                            "frameNumber": 1,
                            "time": 0.2,
                            "data": [
                                1001.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                9.0,
                                -5.69782,
                                129.971,
                                -393.00800000000004,
                                -15.290700000000001,
                                127.437,
                                -394.796,
                                -24.8686,
                                124.766,
                                -396.463,
                                1001.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                18.0,
                                19.0975,
                                -44.6282,
                                -345.032,
                                028.7449,
                                -41.2174,
                                -345.948,
                                38.4093,
                                -37.8622,
                                -346.891,
                                48.0874,
                                -34.5692,
                                -347.90900000000005,
                                57.7825,
                                -31.335799999999995,
                                -348.95599999999996,
                                67.48859999999999,
                                -28.145300000000002,
                                -350.03299999999996,
                                1001.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                12.0,
                                -2.25528,
                                -76.97500000000001,
                                -390.275,
                                2.86711,
                                -71.30789999999999,
                                -385.498,
                                7.987640000000001,
                                -65.6548,
                                -380.702,
                                13.1339,
                                -59.9998,
                                -375.936,
                            ],
                        },
                        {
                            "frameNumber": 2,
                            "time": 0.3,
                            "data": [
                                1001.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                9.0,
                                8.850850000000001,
                                142.58399999999997,
                                -381.975,
                                -0.66752,
                                141.898,
                                -378.722,
                                -10.1991,
                                141.17499999999998,
                                -375.517,
                                1001.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                18.0,
                                -53.0708,
                                -112.578,
                                -323.72499999999997,
                                -48.829299999999996,
                                -106.16799999999999,
                                -330.54200000000003,
                                -44.5379,
                                -99.7703,
                                -337.339,
                                -40.219199999999994,
                                -93.4137,
                                -344.157,
                                -35.9216,
                                -87.07,
                                -351.00100000000003,
                                -31.5842,
                                -80.7395,
                                -357.831,
                                1001.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                12.0,
                                33.213300000000004,
                                -102.894,
                                -367.733,
                                26.529799999999998,
                                -98.4461,
                                -363.644,
                                19.8645,
                                -93.94890000000001,
                                -359.57800000000003,
                                13.2555,
                                -89.3484,
                                -355.537,
                            ],
                        },
                    ],
                },
                "plotData": {"version": 1, "data": []},
            },
        ),
        pytest.param(
            {},
            {},
            marks=pytest.mark.raises(exception=KeyError),  # input data is missing keys
        ),
    ],
)
def test_cytosim_trajectory_reader(trajectory, expected_data):
    converter = Converter(trajectory, "cytosim")
    assert expected_data == converter._data
